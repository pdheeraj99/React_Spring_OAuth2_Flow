# ğŸ—ï¸ 02. Architecture - 3 Services

## ğŸ“Š Complete Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                 â”‚
â”‚                        CLIENT CREDENTIALS ARCHITECTURE                          â”‚
â”‚                                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                              â”‚
â”‚    â”‚   React     â”‚                                                              â”‚
â”‚    â”‚    App      â”‚                                                              â”‚
â”‚    â”‚  (Browser)  â”‚                                                              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                              â”‚
â”‚           â”‚                                                                     â”‚
â”‚           â”‚ Req1: GET /api/orders/check-stock/laptop-001                        â”‚
â”‚           â”‚ (Normal request, no token!)                                         â”‚
â”‚           â–¼                                                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚                     ORDER-SERVICE (8080)                            â”‚      â”‚
â”‚    â”‚                                                                     â”‚      â”‚
â”‚    â”‚  Role: OAuth2 CLIENT                                                â”‚      â”‚
â”‚    â”‚  Job:  Token teeskoni Inventory ni call cheyyali                    â”‚      â”‚
â”‚    â”‚                                                                     â”‚      â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚      â”‚
â”‚    â”‚  â”‚ Req2: POST /oauth2/token                                    â”‚    â”‚      â”‚
â”‚    â”‚  â”‚ Header: Authorization: Basic base64(id:secret)              â”‚â”€â”€â”€â”€â”¼â”€â”€â”   â”‚
â”‚    â”‚  â”‚ Body: grant_type=client_credentials                         â”‚    â”‚  â”‚   â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚   â”‚
â”‚    â”‚                                                                     â”‚  â”‚   â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚   â”‚
â”‚    â”‚  â”‚ Res1: JWT Token received!                                   â”‚â—€â”€â”€â”€â”¼â”€â”€â”¤   â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚   â”‚
â”‚    â”‚                                                                     â”‚  â”‚   â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚   â”‚
â”‚    â”‚  â”‚ Req3: GET /api/stock/laptop-001                             â”‚    â”‚  â”‚   â”‚
â”‚    â”‚  â”‚ Header: Authorization: Bearer <JWT_TOKEN>                   â”‚â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â” â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚ â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ â”‚
â”‚                                                                             â”‚ â”‚ â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚ â”‚ â”‚
â”‚    â”‚        AUTH-SERVER (9000)              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚    â”‚                                        â”‚                                 â”‚ â”‚
â”‚    â”‚  Role: AUTHORIZATION SERVER            â”‚                                 â”‚ â”‚
â”‚    â”‚  Job:  Tokens create & issue           â”‚                                 â”‚ â”‚
â”‚    â”‚                                        â”‚                                 â”‚ â”‚
â”‚    â”‚  Has:                                  â”‚                                 â”‚ â”‚
â”‚    â”‚  â€¢ Private Key (signing)               â”‚                                 â”‚ â”‚
â”‚    â”‚  â€¢ Registered clients (order-service)  â”‚                                 â”‚ â”‚
â”‚    â”‚  â€¢ /oauth2/token endpoint              â”‚                                 â”‚ â”‚
â”‚    â”‚  â€¢ /oauth2/jwks endpoint (public keys) â”‚                                 â”‚ â”‚
â”‚    â”‚                                        â”‚                                 â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚ â”‚
â”‚                                                                               â”‚ â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚ â”‚
â”‚    â”‚      INVENTORY-SERVICE (8081)          â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚                                        â”‚                                   â”‚
â”‚    â”‚  Role: RESOURCE SERVER                 â”‚                                   â”‚
â”‚    â”‚  Job:  Protected data provide          â”‚                                   â”‚
â”‚    â”‚                                        â”‚                                   â”‚
â”‚    â”‚  Has:                                  â”‚                                   â”‚
â”‚    â”‚  â€¢ Public Key (from Auth Server)       â”‚                                   â”‚
â”‚    â”‚  â€¢ JWT validation logic                â”‚                                   â”‚
â”‚    â”‚  â€¢ Scope checking                      â”‚                                   â”‚
â”‚    â”‚  â€¢ /api/stock/* endpoints              â”‚                                   â”‚
â”‚    â”‚                                        â”‚                                   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ­ Service Roles Explained

### 1ï¸âƒ£ AUTH-SERVER (Port 9000)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  AUTH-SERVER = "Security Guard Office"                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                    â•‘
â•‘  JOB:                                                              â•‘
â•‘  â”€â”€â”€â”€                                                              â•‘
â•‘  â€¢ Registered clients ni track cheyyadam                           â•‘
â•‘  â€¢ Client credentials validate cheyyadam                           â•‘
â•‘  â€¢ JWT tokens create & sign cheyyadam                              â•‘
â•‘  â€¢ Public keys share cheyyadam (for verification)                  â•‘
â•‘                                                                    â•‘
â•‘  ENDPOINTS:                                                        â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â•‘
â•‘  POST /oauth2/token              â†’ Token issue                     â•‘
â•‘  GET  /oauth2/jwks               â†’ Public keys                     â•‘
â•‘  GET  /.well-known/openid-config â†’ Server information              â•‘
â•‘                                                                    â•‘
â•‘  HAS (Secret):                                                     â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â•‘
â•‘  â€¢ PRIVATE KEY (for signing tokens)                                â•‘
â•‘  â€¢ Client secrets database                                         â•‘
â•‘                                                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 2ï¸âƒ£ ORDER-SERVICE (Port 8080)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ORDER-SERVICE = "Employee with Badge Request"                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                    â•‘
â•‘  JOB:                                                              â•‘
â•‘  â”€â”€â”€â”€                                                              â•‘
â•‘  â€¢ User requests handle cheyyadam                                  â•‘
â•‘  â€¢ Auth Server nundi token teeskovadam                             â•‘
â•‘  â€¢ Token tho Inventory-Service ni call cheyyadam                   â•‘
â•‘                                                                    â•‘
â•‘  ROLE: OAuth2 CLIENT                                               â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â•‘
â•‘  â€¢ Knows client_id and client_secret                               â•‘
â•‘  â€¢ Automatically gets token when needed                            â•‘
â•‘  â€¢ Attaches token to outgoing requests                             â•‘
â•‘                                                                    â•‘
â•‘  ENDPOINTS:                                                        â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â•‘
â•‘  GET /api/orders/check-stock/{productId} â†’ Stock check trigger     â•‘
â•‘                                                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 3ï¸âƒ£ INVENTORY-SERVICE (Port 8081)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  INVENTORY-SERVICE = "Secure Vault Room"                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                    â•‘
â•‘  JOB:                                                              â•‘
â•‘  â”€â”€â”€â”€                                                              â•‘
â•‘  â€¢ Stock data provide cheyyadam                                    â•‘
â•‘  â€¢ ONLY valid tokens tho requests accept                           â•‘
â•‘  â€¢ JWT signature validate cheyyadam                                â•‘
â•‘  â€¢ Scopes check cheyyadam                                          â•‘
â•‘                                                                    â•‘
â•‘  ROLE: RESOURCE SERVER                                             â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â•‘
â•‘  â€¢ Gets public key from Auth Server                                â•‘
â•‘  â€¢ Validates every incoming token                                  â•‘
â•‘  â€¢ Checks scope permissions                                        â•‘
â•‘                                                                    â•‘
â•‘  ENDPOINTS:                                                        â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â•‘
â•‘  GET /api/stock/{productId} â†’ Returns stock data (PROTECTED!)      â•‘
â•‘                                                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“ Project Structure

```
Client_Credentials_Grant_Project/
â””â”€â”€ Option1_Spring_Auth_Server/
    â”‚
    â”œâ”€â”€ auth-server/                          â† AUTHORIZATION SERVER
    â”‚   â”œâ”€â”€ src/main/java/.../config/
    â”‚   â”‚   â””â”€â”€ AuthorizationServerConfig.java  â† ğŸ”‘ KEY FILE!
    â”‚   â””â”€â”€ src/main/resources/
    â”‚       â””â”€â”€ application.yaml
    â”‚
    â”œâ”€â”€ order-service/                        â† OAUTH2 CLIENT
    â”‚   â”œâ”€â”€ src/main/java/.../config/
    â”‚   â”‚   â””â”€â”€ WebClientConfig.java           â† Token auto-attach
    â”‚   â”œâ”€â”€ src/main/java/.../controller/
    â”‚   â”‚   â””â”€â”€ OrderController.java           â† API endpoints
    â”‚   â””â”€â”€ src/main/resources/
    â”‚       â””â”€â”€ application.yaml               â† Client config
    â”‚
    â””â”€â”€ inventory-service/                    â† RESOURCE SERVER
        â”œâ”€â”€ src/main/java/.../config/
        â”‚   â””â”€â”€ SecurityConfig.java            â† JWT validation
        â”œâ”€â”€ src/main/java/.../controller/
        â”‚   â””â”€â”€ StockController.java           â† Protected API
        â””â”€â”€ src/main/resources/
            â””â”€â”€ application.yaml               â† issuer-uri config
```

---

## ğŸ”— Communication Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                    â”‚
â”‚  WHO CALLS WHOM?                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚                                                                    â”‚
â”‚  User â†’ Order-Service         (Normal request)                     â”‚
â”‚  Order-Service â†’ Auth Server  (Get token)                          â”‚
â”‚  Order-Service â†’ Inventory    (Use token)                          â”‚
â”‚  Inventory â†’ Auth Server      (Get public key, at startup)         â”‚
â”‚                                                                    â”‚
â”‚  Auth Server is CENTRAL but NOT in data path!                      â”‚
â”‚  Once token issued, data flows directly between services!          â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Next:** [03_Request_Flow.md](./03_Request_Flow.md) - Detailed request/response flow
